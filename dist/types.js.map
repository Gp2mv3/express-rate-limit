{"version":3,"file":"types.js","sourceRoot":"","sources":["../source/types.ts"],"names":[],"mappings":"AAAA,mBAAmB;AACnB,qCAAqC","sourcesContent":["// /source/types.ts\n// All the types used by this package\n\nimport Express from 'express'\n\n/**\n * Callback that fires when a client's hit counter is incremented.\n *\n * @param error {Error | undefined} - The error that occurred, if any\n * @param hit {number} - The number of hits for that client so far\n * @param resetTime {Date | undefined} - The time when the counter resets\n *\n * @public\n */\nexport type IncrementCallback = (\n\terror: Error | undefined,\n\thit: number,\n\tresetTime: Date | undefined,\n) => void\n\n/**\n * Method (in the form of middleware) to generate custom identifiers for\n * clients.\n *\n * @param request {Express.Request} - The Express request object\n * @param response {Express.Response} - The Express response object\n *\n * @returns {string} - The string used to identify the client\n *\n * @public\n */\nexport type KeyGeneratingMiddleware = (\n\trequest: Express.Request,\n\tresponse: Express.Response,\n) => string | Promise<string>\n\n/**\n * Method (in the form of middleware) to determine whether or not this request\n * counts towards a client's quota.\n *\n * @param request {Express.Request} - The Express request object\n * @param response {Express.Response} - The Express response object\n *\n * @returns {boolean} - Whether or not this request counts towards the quota\n *\n * @public\n */\nexport type ShouldSkipMiddleware = (\n\trequest: Express.Request,\n\tresponse: Express.Response,\n) => boolean | Promise<boolean>\n\n/**\n * A modified Express request handler with the rate limit functions.\n */\nexport type RateLimitRequestHandler = Express.RequestHandler & {\n\t/**\n\t * Method to reset a client's hit counter.\n\t *\n\t * @param key {string} - The identifier for a client\n\t */\n\tresetKey: (key: string) => void\n}\n\n/**\n * An interface that all hit counter stores must implement.\n */\nexport interface Store {\n\t/**\n\t * Method to increment a client's hit counter.\n\t *\n\t * @param key {string} - The identifier for a client\n\t * @param callback {IncrementCallback} - The callback to call once the counter is incremented\n\t */\n\tincrement: (key: string, callback: IncrementCallback) => void\n\n\t/**\n\t * Method to decrement a client's hit counter.\n\t *\n\t * @param key {string} - The identifier for a client\n\t */\n\tdecrement: (key: string) => void\n\n\t/**\n\t * Method to reset a client's hit counter.\n\t *\n\t * @param key {string} - The identifier for a client\n\t */\n\tresetKey: (key: string) => void\n\n\t/**\n\t * Method to reset everyone's hit counter.\n\t */\n\tresetAll?: () => void\n}\n\n/**\n * The configuration options for the rate limiter.\n */\nexport interface Options {\n\t/**\n\t * How long we should remember the requests\n\t */\n\treadonly windowMs: number\n\n\t/**\n\t * The maximum number of connection to allow during the `window` before\n\t * rate limiting the client.\n\t *\n\t * Can be the limit itself as a number or express middleware that parses\n\t * the request and then figures out the limit.\n\t */\n\treadonly max:\n\t\t| number\n\t\t| ((\n\t\t\t\trequest: Express.Request,\n\t\t\t\tresponse: Express.Response,\n\t\t  ) => number | Promise<number>)\n\n\t/**\n\t * The response body to send back when a client is rate limited.\n\t */\n\treadonly message: any\n\n\t/**\n\t * The HTTP status code to send back when a client is rate limited.\n\t *\n\t * Defaults to `HTTP 429 Too Many Requests` (RFC 6585).\n\t */\n\treadonly statusCode: number\n\n\t/**\n\t * Whether to send custom headers with the rate limit and the number of\n\t * requests.\n\t */\n\treadonly headers: boolean\n\n\t/**\n\t * Whether to enable support for the rate limit standardization headers.\n\t */\n\treadonly useStandardizedHeaders: boolean\n\n\t/**\n\t * The name of the property on the request object to store the rate limit info.\n\t *\n\t * Defaults to `rateLimit`.\n\t */\n\treadonly requestPropertyName: string\n\n\t/**\n\t * If `true`, the library will (by default) skip all requests that have a 4XX\n\t * or 5XX status.\n\t */\n\treadonly skipFailedRequests: boolean\n\n\t/**\n\t * If `true`, the library will (by default) skip all requests that have a\n\t * status code less than 400.\n\t */\n\treadonly skipSuccessfulRequests: boolean\n\n\t/**\n\t * Method to determine whether or not the request counts as 'succesful'. Used\n\t * when either `skipSuccessfulRequests` or `skipFailedRequests` is set to true.\n\t */\n\treadonly requestWasSuccessful: ShouldSkipMiddleware\n\n\t/**\n\t * Method to generate custom identifiers for clients.\n\t *\n\t * By default, the client's IP address is used.\n\t */\n\treadonly keyGenerator: KeyGeneratingMiddleware\n\n\t/**\n\t * Method (in the form of middleware) to determine whether or not this request\n\t * counts towards a client's quota.\n\t */\n\treadonly skip: ShouldSkipMiddleware\n\n\t/**\n\t * Express request handler that sends back a response when a client is\n\t * rate-limited.\n\t */\n\treadonly handler: (\n\t\trequest: Express.Request,\n\t\tresponse: Express.Response,\n\t\toptionsUsed: Options,\n\t) => void\n\n\t/**\n\t * Express request handler that sends back a response when a client has\n\t * reached their rate limit.\n\t */\n\treadonly onLimitReached: (\n\t\trequest: Express.Request,\n\t\tresponse: Express.Response,\n\t\toptionsUsed: Options,\n\t) => void\n\n\t/**\n\t * The {@link Store} to use to store the hit count for each client.\n\t */\n\treadonly store: Store\n\n\t/**\n\t * The number of requests after which responses should be delayed.\n\t *\n\t * @deprecated 3.x - This functionality was moved to the [`express-slow-down` package](https://www.npmjs.com/package/express-slow-down).\n\t */\n\tdelayAfter?: number\n\n\t/**\n\t * The time requests should by delayed by, when the client exceeds a certain\n\t * number of requests.\n\t *\n\t * @deprecated 3.x - This functionality was moved to the [`express-slow-down` package](https://www.npmjs.com/package/express-slow-down).\n\t */\n\tdelayMs?: number\n\n\t/**\n\t * Whether the rate limiter should limit each client individually or all\n\t * requests made to the server.\n\t *\n\t * @deprecated 2.x\n\t */\n\tglobal?: boolean\n}\n\n/**\n * The extended request object that includes information about the client's\n * rate limit.\n */\nexport type AugmentedRequest = Express.Request & {\n\t[key: string]: RateLimitInfo\n}\n\n/**\n * The rate limit related information for each client included in the\n * Express request object.\n */\nexport interface RateLimitInfo {\n\treadonly limit: number\n\treadonly current: number\n\treadonly remaining: number\n\treadonly resetTime: Date | undefined\n}\n"]}